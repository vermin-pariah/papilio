# 代码审查清单 (Code Review Checklist)

在提交 PR 或合并代码前，Reviewer 必须强制核对以下项目。

## 🛡️ 安全性 (Security) - 零容忍

- [ ] **文件上传**: 是否使用了 `infer` 库进行 Magic Number (MIME) 校验？（严禁只查后缀名）
- [ ] **路径安全**: 写入文件系统前，是否使用了 `sanitize-filename` 处理文件名？（严禁裸拼接）
- [ ] **权限控制**: 所有非公开接口是否都经过了 `get_user_id` 校验？
- [ ] **SQL 注入**: 是否使用了 `sqlx::query!` 宏或参数化绑定？（严禁 `format!` 拼接 SQL）

## 🚀 性能 (Performance)

- [ ] **N+1 问题**: 循环中是否存在 SQL 查询？（必须使用 `UNNEST`、`WHERE IN` 或 `JOIN` 优化）
- [ ] **IO 阻塞**: 文件 IO 操作是否使用了 `tokio::fs` 而非 `std::fs`？
- [ ] **并发控制**: 长耗时任务（扫描、同步）是否检查了全局 `SCAN_LOCK`？

## 🏗️ 架构与规范

- [ ] **错误码**: 权限拒绝是否返回 403 而非 400？资源不存在是否返回 404？
- [ ] **状态机**: 数据库状态变更是否包裹在事务 (Transaction) 中？
- [ ] **移动端**: 列表项是否处理了 `TextOverflow`？图片加载是否使用了缓存？

## 🧪 测试 (Testing)

- [ ] **核心逻辑**: 是否为新的业务逻辑编写了 `#[test]` 单元测试？
- [ ] **集成测试**: 是否在 `tests/` 下补充了 API 端到端测试？
